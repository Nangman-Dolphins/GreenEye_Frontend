# GreenEye CCU (중앙 제어 유닛) 웹 애플리케이션

본 레포지토리는 "GreenEye 원예용 센서 단말기"와 연동되는 React 기반의 중앙 제어 유닛(CCU) 웹 애플리케이션이다.

이 애플리케이션의 목적은 사용자가 등록한 여러 센서 단말기(ESP32-CAM)로부터 수집된 데이터를 시각화하고, 원격으로 장치를 제어하며, AI 기반의 진단 및 챗봇 기능을 통해 식물 관리를 보조하는 통합 대시보드를 제공하는 것이다.

## 주요 기능

* **사용자 인증:** 회원가입 (`Register.jsx`) 및 로그인 (`Login.jsx`) 기능을 통해 사용자별 데이터를 관리한다.

* **통합 대시보드 (`Dashboard.jsx`):** 로그인 후의 메인 페이지로, 등록된 모든 화분(장치)의 상태를 한눈에 볼 수 있는 갤러리와 선택된 장치의 상세 정보를 표시한다.

* **장치 관리 (`DeviceLink.jsx`, `PlantGallery.jsx`):**
    * 새로운 센서 단말기(MAC 주소, 이름, 위치, 식물 종류, 대표 이미지)를 등록한다.
    * 등록된 장치들을 '방(Room)'별로 그룹화하여 갤러리 형태로 시각화하며, 선택 및 삭제가 가능하다.

* **실시간 모니터링 (`SensorInfo.jsx`):**
    * 선택된 장치로부터 전송된 최신 센서 데이터(환경/토양 온도, 습도, 광량, EC 등)를 실시간으로 표시한다.
    * 센서 값이 정상 범위를 벗어날 경우 "조치 안내" (예: "물을 주세요")를 자동으로 제공한다.
    * 백엔드로부터 수신한 "AI 진단" 결과와 "최신 사진"을 모달로 확인할 수 있다.

* **원격 장치 제어 (`ControlPanel.jsx`):**
    * 선택된 장치에 연결된 액추에이터(가습기, UV LED, 팬, 워터펌프)를 원격으로 ON/OFF 할 수 있는 제어 명령(MQTT 경유)을 전송한다.

* **AI 기반 챗봇 (`ChatAssistant.jsx`):**
    * Gemini API (`/api/chat/gemini`)와 연동된 AI 챗봇 인터페이스를 제공한다.
    * 사용자는 텍스트뿐만 아니라 식물 이미지를 업로드하여 현재 상태에 대한 질문이나 진단을 요청할 수 있다.
    * 대화 내용은 `conversation_id`를 기반으로 서버에 저장되고 복원된다.

## 레포지토리 구성 (컴포넌트 상세)

### 1. 인증 (`/auth`)

* **`Login.jsx`**: 사용자 로그인 폼. 성공 시 `AuthContext`를 갱신하고 대시보드로 이동한다.
* **`Register.jsx`**: 사용자 회원가입 폼.

### 2. 메인 대시보드 (`/dashboard`)

* **`Dashboard.jsx`**:
    * **역할:** 모든 핵심 컴포넌트를 통합하는 메인 컨테이너.
    * **상세:** `PlantGallery`, `SensorInfo`, `ControlPanel`을 조합하여 화면을 구성한다. 'AI 챗봇', '설정', '기기 연결', '로그아웃' 등 앱의 메인 네비게이션을 담당한다.

* **`PlantGallery.jsx`**:
    * **역할:** 사용자가 등록한 모든 장치(화분)를 시각화하는 갤러리.
    * **상세:** 장치들을 '방(Room)'별로 자동 그룹핑하여 표시한다. 사용자가 특정 장치를 클릭(선택)하거나 삭제할 수 있는 인터페이스를 제공한다.

* **`SensorInfo.jsx`**:
    * **역할:** 선택된 장치의 상세 센서 데이터 및 AI 진단 결과를 표시하는 핵심 정보 카드.
    * **상세:** `/api/latest_sensor_data/:id`로 주기적으로 데이터를 폴링한다. 수신한 데이터를 '환경 상태'와 '토양 상태'로 구분하여 표시한다. 백엔드가 제공하는 `status` (low/middle/high)에 따라 '조치 안내'를 생성하고, 'AI 진단' 내용을 보여준다. '최신 사진' 버튼으로 `/api/devices/:id/latest-image`를 호출하여 이미지 모달을 띄운다.

* **`ControlPanel.jsx`**:
    * **역할:** 선택된 장치에 원격 제어 명령을 전송하는 패널.
    * **상세:** 'HUMIDIFIER', 'UV', 'FAN', 'WATERPUMP' 등의 버튼을 제공한다. 버튼 클릭 시 `/api/control_device/:id` 엔드포인트로 제어용 JSON 페이로드를 POST 요청한다.

### 3. 장치 관리 (`/devices`)

* **`DeviceLink.jsx`**:
    * **역할:** 새로운 센서 단말기를 시스템에 등록하는 폼 페이지.
    * **상세:** 장치 이름, MAC 주소(ID), 위치(Room), 식물 종류, 대표 사진을 입력받는다. 사진은 `FormData` 객체로 변환되어 `/api/register_device`로 전송된다.

### 4. AI 어시스턴트 (`/assistant`)

* **`ChatAssistant.jsx`**:
    * **역할:** Gemini API와 연동되는 AI 기반 챗봇 페이지.
    * **상세:** 사용자가 텍스트와 이미지를 함께 전송할 수 있다 (`/api/chat/gemini`). 대화 내용은 `conversation_id`를 기준으로 관리되며, `/api/chat/history`를 통해 이전 대화를 불러온다. 봇의 응답은 `ReactMarkdown`을 통해 렌더링된다.

### 5. 기타 컴포넌트

* **`StatsChart.jsx`**: `/api/stats`에서 데이터를 받아와 간단한 차트를 그리는 컴포넌트 (현재 대시보드에 통합되지는 않은 것으로 보임).
* **`EmailConsentRow.jsx`**: 설정 페이지의 일부이며, 사용자에게 'PDF 이메일 수신 동의' 여부를 받아 `/api/user/email-consent`로 전송한다.